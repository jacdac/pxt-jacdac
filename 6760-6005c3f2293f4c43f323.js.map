{"version":3,"file":"6760-6005c3f2293f4c43f323.js","mappings":"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","sources":["webpack://jacdac-docs/./src/components/dashboard/DashboardMatrixKeypad.tsx"],"sourcesContent":["import React, { SVGProps, useRef } from \"react\"\nimport { MatrixKeypadReg } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport SvgWidget from \"../widgets/SvgWidget\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\nimport useServiceServer from \"../hooks/useServiceServer\"\nimport useFireKey from \"../hooks/useFireKey\"\nimport useKeyboardNavigationProps from \"../hooks/useKeyboardNavigationProps\"\nimport { MatrixKeypadServer } from \"../../../jacdac-ts/src/servers/matrixkeypadserver\"\nimport useWidgetSize from \"../widgets/useWidgetSize\"\nimport useRegister from \"../hooks/useRegister\"\nimport DashboardRegisterValueFallback from \"./DashboardRegisterValueFallback\"\n\nexport default function DashboardMatrixKeypad(props: DashboardServiceProps) {\n    const { service, services, variant } = props\n\n    const widgetRef = useRef<SVGGElement>()\n    const pressedRegister = useRegister(service, MatrixKeypadReg.Pressed)\n    const labelsRegister = useRegister(service, MatrixKeypadReg.Labels)\n    const rowsRegister = useRegister(service, MatrixKeypadReg.Rows)\n    const columnsRegister = useRegister(service, MatrixKeypadReg.Columns)\n\n    const [pressed] = useRegisterUnpackedValue<[[number][]]>(\n        pressedRegister,\n        props\n    )\n    const [labels] = useRegisterUnpackedValue<[[string][]]>(\n        labelsRegister,\n        props\n    )\n    const [rows] = useRegisterUnpackedValue<[number]>(rowsRegister, props)\n    const [columns] = useRegisterUnpackedValue<[number]>(columnsRegister, props)\n    const server = useServiceServer<MatrixKeypadServer>(service)\n    const color = server ? \"secondary\" : \"primary\"\n    const { background, controlBackground, active, textProps } =\n        useWidgetTheme(color)\n    const widgetSize = useWidgetSize(variant, services?.length)\n\n    // no data about layout\n    if (rows === undefined || columns === undefined)\n        return (\n            <DashboardRegisterValueFallback\n                register={rows === undefined ? rowsRegister : columnsRegister}\n            />\n        )\n\n    const clickeable = !!server\n    // compute size\n    const pw = 8\n    const ph = 8\n    const ps = 0.5\n    const pr = 1\n    const m = 2\n    const w = columns * pw + (columns + 1) * m\n    const h = rows * ph + (rows + 1) * m\n\n    const handleButtonUp = (index: number) => () => {\n        server.up(index)\n        pressedRegister.refresh()\n    }\n    const handleButtonDown = (index: number) => () => {\n        server.down(index)\n        pressedRegister.refresh()\n    }\n\n    // add leds\n    const render = () => {\n        const ledEls: JSX.Element[] = []\n        const ledProps: SVGProps<SVGRectElement> = {\n            className: clickeable ? \"clickeable\" : undefined,\n            role: clickeable ? \"button\" : \"\",\n            tabIndex: clickeable ? 0 : undefined,\n        }\n\n        let y = m\n        for (let row = 0; row < rows; row++) {\n            let x = m\n            for (let col = 0; col < columns; col++) {\n                const index = row * columns + col\n                const on = pressed?.findIndex(p => p[0] === index) > -1\n                const label = labels?.[index]?.[0]\n\n                const handleUp = clickeable ? handleButtonUp(index) : undefined\n                const handleDown = clickeable\n                    ? handleButtonDown(index)\n                    : undefined\n                const fireUp = useFireKey(handleUp)\n                const fireDown = useFireKey(handleDown)\n\n                ledEls.push(\n                    <rect\n                        key={`l${row}-${col}`}\n                        x={x}\n                        y={y}\n                        width={pw}\n                        height={ph}\n                        rx={pr}\n                        ry={pr}\n                        fill={on ? active : controlBackground}\n                        stroke={\"none\"}\n                        strokeWidth={ps}\n                        {...ledProps}\n                        aria-label={label || `key ${row},${col}`}\n                        onKeyDown={fireDown}\n                        onKeyUp={fireUp}\n                        onPointerDown={handleDown}\n                        onPointerUp={handleUp}\n                    />\n                )\n                if (label) {\n                    ledEls.push(\n                        <text\n                            key={`t${row}-${col}`}\n                            fontSize={(ph * 2) / 3}\n                            {...textProps}\n                            x={x + pw / 2}\n                            y={y + ph / 2}\n                        >\n                            {label}\n                        </text>\n                    )\n                }\n                x += pw + m\n            }\n            y += ph + m\n        }\n        return { ledEls }\n    }\n\n    const { ledEls } = render()\n    const navProps = useKeyboardNavigationProps(widgetRef.current)\n    return (\n        <SvgWidget width={w} height={h} size={widgetSize}>\n            <rect\n                x={0}\n                y={0}\n                width={w}\n                height={h}\n                rx={pr}\n                ry={pr}\n                fill={background}\n            />\n            <g ref={widgetRef} {...navProps}>\n                {ledEls}\n            </g>\n        </SvgWidget>\n    )\n}\n"],"names":["widgetRef","useRef","pressedRegister","useRegister","MatrixKeypadReg","labelsRegister","rowsRegister","columnsRegister","useRegisterUnpackedValue","server","useServiceServer","color","useWidgetTheme","widgetSize","useWidgetSize","services","rows","columns","clickeable","pw","ph","ps","pr","m","w","h","handleButtonUp","index","handleButtonDown","render","ledEls","ledProps","className","role","tabIndex","y","row","x","col","on","p","label","labels","handleUp","handleDown","fireUp","useFireKey","fireDown","navProps","useKeyboardNavigationProps"],"sourceRoot":""}